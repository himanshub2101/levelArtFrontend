{"ast":null,"code":"var _reactJsxRuntime = require(\"react/jsx-runtime\");\nvar _defineProperty = require(\"@babel/runtime/helpers/defineProperty\");\nvar _toConsumableArray = require(\"@babel/runtime/helpers/toConsumableArray\");\nvar _asyncToGenerator = require(\"@babel/runtime/helpers/asyncToGenerator\");\nvar _slicedToArray = require(\"@babel/runtime/helpers/slicedToArray\");\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nvar HomeScreen = function HomeScreen(_ref) {\n  var route = _ref.route;\n  var _useContext = useContext(UserType),\n    userId = _useContext.userId,\n    setUserId = _useContext.setUserId;\n  var _useState = useState([]),\n    _useState2 = _slicedToArray(_useState, 2),\n    posts = _useState2[0],\n    setPosts = _useState2[1];\n  var _useState3 = useState(false),\n    _useState4 = _slicedToArray(_useState3, 2),\n    refreshing = _useState4[0],\n    setRefreshing = _useState4[1];\n  var _useState5 = useState(false),\n    _useState6 = _slicedToArray(_useState5, 2),\n    userIdSet = _useState6[0],\n    setUserIdSet = _useState6[1];\n  var _useState7 = useState(false),\n    _useState8 = _slicedToArray(_useState7, 2),\n    showChat = _useState8[0],\n    setShowChat = _useState8[1];\n  var _useState9 = useState(null),\n    _useState10 = _slicedToArray(_useState9, 2),\n    selectedPost = _useState10[0],\n    setSelectedPost = _useState10[1];\n  var _useState11 = useState(false),\n    _useState12 = _slicedToArray(_useState11, 2),\n    modalVisible = _useState12[0],\n    setModalVisible = _useState12[1];\n  var _useState13 = useState(false),\n    _useState14 = _slicedToArray(_useState13, 2),\n    showCommentInput = _useState14[0],\n    setShowCommentInput = _useState14[1];\n  var _useState15 = useState(''),\n    _useState16 = _slicedToArray(_useState15, 2),\n    commentText = _useState16[0],\n    setCommentText = _useState16[1];\n  var _useState17 = useState([]),\n    _useState18 = _slicedToArray(_useState17, 2),\n    savedPosts = _useState18[0],\n    setSavedPosts = _useState18[1];\n  useEffect(function () {\n    var fetchUserData = function () {\n      var _ref2 = _asyncToGenerator(function* () {\n        try {\n          var token = yield AsyncStorage.getItem(\"authToken\");\n          if (!token) {\n            console.log(\"Token not found\");\n            return;\n          }\n          var decodedToken = jwt_decode(token);\n          if (!decodedToken || !decodedToken.sub) {\n            console.log(\"Decoded token or user ID not found\");\n            return;\n          }\n          var _userId = decodedToken.sub;\n          setUserId(_userId);\n          setUserIdSet(true);\n          fetchPosts();\n        } catch (error) {\n          console.error(\"Error fetching user data:\", error);\n        }\n      });\n      return function fetchUserData() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n    fetchUserData();\n  }, [route]);\n  useEffect(function () {\n    if (userIdSet) {\n      fetchPosts();\n    }\n  }, [userIdSet]);\n  var onRefresh = useCallback(function () {\n    setRefreshing(true);\n    fetchPosts();\n    setRefreshing(false);\n  }, []);\n  var fetchPosts = function () {\n    var _ref3 = _asyncToGenerator(function* () {\n      try {\n        var token = yield AsyncStorage.getItem(\"authToken\");\n        var decodedToken = jwt_decode(token);\n        var headers = {\n          Authorization: `Bearer ${token}`,\n          \"Content-Type\": \"application/json\"\n        };\n        var responseFollowings = yield axios.get(`https://levelart.up.railway.app/followers/${userId}/following`, {\n          headers: headers\n        });\n        var followings = responseFollowings.data;\n        var postsPromises = followings.map(function () {\n          var _ref4 = _asyncToGenerator(function* (followingId) {\n            var response = yield axios.get(`https://levelart.up.railway.app/user/${followingId}`, {\n              headers: headers\n            });\n            return response.data;\n          });\n          return function (_x) {\n            return _ref4.apply(this, arguments);\n          };\n        }());\n        var responseUserPosts = yield axios.get(`https://levelart.up.railway.app/posts/user/${userId}`, {\n          headers: headers\n        });\n        var userPosts = responseUserPosts.data;\n        var postsResponses = yield Promise.all(postsPromises);\n        var allPosts = postsResponses.reduce(function (accumulator, currentPosts) {\n          return accumulator.concat(currentPosts);\n        }, []);\n        var combinedPosts = [].concat(_toConsumableArray(allPosts), _toConsumableArray(userPosts)).map(function (post) {\n          return _objectSpread(_objectSpread({}, post), {}, {\n            liked: post.likes.includes(userId)\n          });\n        });\n        var sortedPosts = combinedPosts.sort(function (a, b) {\n          return b.likes.length - a.likes.length;\n        });\n        setPosts(sortedPosts);\n      } catch (error) {\n        console.log(\"Error fetching posts\", error);\n      }\n    });\n    return function fetchPosts() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n  var renderPost = function renderPost(post) {\n    return _reactJsxRuntime.jsx(View, {\n      style: styles.post\n    }, `${post.postedBy}-${post.postId}`);\n  };\n  return _reactJsxRuntime.jsxs(ScrollView, {\n    style: styles.container,\n    refreshControl: _reactJsxRuntime.jsx(RefreshControl, {\n      refreshing: refreshing,\n      onRefresh: onRefresh\n    }),\n    children: [_reactJsxRuntime.jsx(View, {\n      style: styles.header\n    }), _reactJsxRuntime.jsx(View, {\n      style: styles.postContainer,\n      children: posts.map(function (post) {\n        return renderPost(post);\n      })\n    }), _reactJsxRuntime.jsx(Modal, {\n      animationType: \"slide\",\n      transparent: true,\n      visible: modalVisible,\n      onRequestClose: closeOptionsModal\n    }), showChat && _reactJsxRuntime.jsx(MessageContainer, {})]\n  });\n};","map":{"version":3,"names":["HomeScreen","_ref","route","_useContext","useContext","UserType","userId","setUserId","_useState","useState","_useState2","_slicedToArray","posts","setPosts","_useState3","_useState4","refreshing","setRefreshing","_useState5","_useState6","userIdSet","setUserIdSet","_useState7","_useState8","showChat","setShowChat","_useState9","_useState10","selectedPost","setSelectedPost","_useState11","_useState12","modalVisible","setModalVisible","_useState13","_useState14","showCommentInput","setShowCommentInput","_useState15","_useState16","commentText","setCommentText","_useState17","_useState18","savedPosts","setSavedPosts","useEffect","fetchUserData","_ref2","_asyncToGenerator","token","AsyncStorage","getItem","console","log","decodedToken","jwt_decode","sub","fetchPosts","error","apply","arguments","onRefresh","useCallback","_ref3","headers","Authorization","responseFollowings","axios","get","followings","data","postsPromises","map","_ref4","followingId","response","_x","responseUserPosts","userPosts","postsResponses","Promise","all","allPosts","reduce","accumulator","currentPosts","concat","combinedPosts","_toConsumableArray","post","_objectSpread","liked","likes","includes","sortedPosts","sort","a","b","length","renderPost","_reactJsxRuntime","jsx","View","style","styles","postedBy","postId","jsxs","ScrollView","container","refreshControl","RefreshControl","children","header","postContainer","Modal","animationType","transparent","visible","onRequestClose","closeOptionsModal","MessageContainer"],"sources":["C:/Users/DELL/Documents/Confidentials/levelArtFrontend/screens/HomeScreen.js"],"sourcesContent":["const HomeScreen = ({ route }) => {\r\n  const { userId, setUserId } = useContext(UserType);\r\n  const [posts, setPosts] = useState([]);\r\n  const [refreshing, setRefreshing] = useState(false);\r\n  const [userIdSet, setUserIdSet] = useState(false);\r\n  const [showChat, setShowChat] = useState(false);\r\n  const [selectedPost, setSelectedPost] = useState(null);\r\n  const [modalVisible, setModalVisible] = useState(false);\r\n  const [showCommentInput, setShowCommentInput] = useState(false);\r\n  const [commentText, setCommentText] = useState('');\r\n  const [savedPosts, setSavedPosts] = useState([]);\r\n\r\n  useEffect(() => {\r\n    const fetchUserData = async () => {\r\n      try {\r\n        const token = await AsyncStorage.getItem(\"authToken\");\r\n        if (!token) {\r\n          console.log(\"Token not found\");\r\n          return;\r\n        }\r\n        const decodedToken = jwt_decode(token);\r\n        if (!decodedToken || !decodedToken.sub) {\r\n          console.log(\"Decoded token or user ID not found\");\r\n          return;\r\n        }\r\n        const userId = decodedToken.sub;\r\n        setUserId(userId);\r\n        setUserIdSet(true);\r\n        fetchPosts();\r\n      } catch (error) {\r\n        console.error(\"Error fetching user data:\", error);\r\n      }\r\n    };\r\n    fetchUserData();\r\n  }, [route]);\r\n\r\n  useEffect(() => {\r\n    if (userIdSet) {\r\n      fetchPosts();\r\n    }\r\n  }, [userIdSet]);\r\n\r\n  const onRefresh = useCallback(() => {\r\n    setRefreshing(true);\r\n    fetchPosts();\r\n    setRefreshing(false);\r\n  }, []);\r\n\r\n  const fetchPosts = async () => {\r\n    try {\r\n      const token = await AsyncStorage.getItem(\"authToken\");\r\n      const decodedToken = jwt_decode(token);\r\n      const headers = {\r\n        Authorization: `Bearer ${token}`,\r\n        \"Content-Type\": \"application/json\",\r\n      };\r\n\r\n      const responseFollowings = await axios.get(`https://levelart.up.railway.app/followers/${userId}/following`, { headers });\r\n      const followings = responseFollowings.data;\r\n      const postsPromises = followings.map(async (followingId) => {\r\n        const response = await axios.get(`https://levelart.up.railway.app/user/${followingId}`, { headers });\r\n        return response.data;\r\n      });\r\n\r\n      const responseUserPosts = await axios.get(`https://levelart.up.railway.app/posts/user/${userId}`, { headers });\r\n      const userPosts = responseUserPosts.data;\r\n      const postsResponses = await Promise.all(postsPromises);\r\n\r\n      const allPosts = postsResponses.reduce((accumulator, currentPosts) => accumulator.concat(currentPosts), []);\r\n\r\n      const combinedPosts = [...allPosts, ...userPosts].map(post => ({ ...post, liked: post.likes.includes(userId) }));\r\n\r\n      // Sort posts based on criteria (e.g., likes, date)\r\n      const sortedPosts = combinedPosts.sort((a, b) => b.likes.length - a.likes.length);\r\n\r\n      setPosts(sortedPosts);\r\n    } catch (error) {\r\n      console.log(\"Error fetching posts\", error);\r\n    }\r\n  };\r\n\r\n  const renderPost = (post) => {\r\n    return (\r\n      <View key={`${post.postedBy}-${post.postId}`} style={styles.post}>\r\n        {/* Render post content */}\r\n      </View>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <ScrollView\r\n      style={styles.container}\r\n      refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} />}\r\n    >\r\n      {/* Render header */}\r\n      <View style={styles.header}>\r\n        {/* Render tabs */}\r\n      </View>\r\n\r\n      {/* Render posts */}\r\n      <View style={styles.postContainer}>\r\n        {posts.map((post) => renderPost(post))}\r\n      </View>\r\n\r\n      {/* Render options modal */}\r\n      <Modal\r\n        animationType=\"slide\"\r\n        transparent={true}\r\n        visible={modalVisible}\r\n        onRequestClose={closeOptionsModal}\r\n      >\r\n        {/* Render modal content */}\r\n      </Modal>\r\n\r\n      {/* Render chat container */}\r\n      {showChat && <MessageContainer />}\r\n    </ScrollView>\r\n  );\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}